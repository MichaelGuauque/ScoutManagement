<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Agregar Miembro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        const cargosPorRol = {
            ADULTO: [
                { value: 'JEFE_MANADA', text: 'Jefe de Manada' },
                { value: 'JEFE_TROPA', text: 'Jefe de Tropa' },
                { value: 'JEFE_COMUNIDAD', text: 'Jefe de Comunidad' },
                { value: 'JEFE_CLAN', text: 'Jefe de Clan' }
            ],
            JOVEN: [
                { value: 'LOBATO', text: 'Lobato' },
                { value: 'SCOUT', text: 'Scout' },
                { value: 'CAMINANTE', text: 'Caminante' },
                { value: 'ROVER', text: 'Rover' }
            ],
            PUBLICO: []
        };

        const ramaPorCargo = {
            JEFE_MANADA: 'MANADA',
            LOBATO: 'MANADA',
            JEFE_TROPA: 'TROPA',
            SCOUT: 'TROPA',
            JEFE_COMUNIDAD: 'COMUNIDAD',
            CAMINANTE: 'COMUNIDAD',
            JEFE_CLAN: 'CLAN',
            ROVER: 'CLAN'
        };

        function actualizarCargos() {
            const rolSelect = document.getElementById('rol');
            const cargoSelect = document.getElementById('cargo');
            const ramaSelect = document.getElementById('rama');
            const rolSeleccionado = rolSelect.value;

            cargoSelect.innerHTML = '<option selected>Selecciona el Cargo...</option>';
            cargoSelect.disabled = true;

            if (rolSeleccionado && cargosPorRol[rolSeleccionado]) {
                cargosPorRol[rolSeleccionado].forEach(cargo => {
                    const option = document.createElement('option');
                    option.value = cargo.value;
                    option.text = cargo.text;
                    cargoSelect.appendChild(option);
                });
                cargoSelect.disabled = false;
            }

            // Limpiar rama si se cambia el rol
            ramaSelect.value = '';
        }

        function actualizarRama() {
            const cargoSelect = document.getElementById('cargo');
            const ramaSelect = document.getElementById('rama');
            const cargoSeleccionado = cargoSelect.value;

            if (ramaPorCargo[cargoSeleccionado]) {
                ramaSelect.value = ramaPorCargo[cargoSeleccionado];
            } else {
                ramaSelect.value = '';
            }
        }

        // Vincular el evento al cambio de cargo
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('cargo').addEventListener('change', actualizarRama);
        });
    </script>

</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title mb-3">Agregar un Miembro al Grupo</h3>
            <p class="text-muted">Ingresa los datos principales del nuevo integrante para incluirlo en el sistema.</p>

            <!-- Formulario con Thymeleaf -->
            <form th:action="@{/guardar}" method="post" >
                <!-- Información Básica -->
                <h5 class="mt-4">Información Básica</h5>
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Primer Nombre</label>
                        <input type="text" class="form-control" name="primerNombre" id="primerNombre" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Segundo Nombre</label>
                        <input type="text" class="form-control" name="segundoNombre" id="segundoNombre" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Primer Apellido</label>
                        <input type="text" class="form-control" name="primerApellido" id="primerApellido" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Segundo Apellido</label>
                        <input type="text" class="form-control" name="segundoApellido" id="segundoApellido" required>
                    </div>
                </div>

                <div class="row g-3 mt-3">
                    <div class="col-md-4">
                        <label class="form-label">Tipo de Documento</label>
                        <select class="form-select" name="tipoDeDocumento" required>
                            <option value="" disabled selected>Seleccione...</option>
                            <th:block th:each="tipoDeDocumento : ${tiposDeDocumento}">
                                <option th:value="${tipoDeDocumento}" th:text="${tipoDeDocumento}"></option></th:block>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Número Documento</label>
                        <input type="number" class="form-control" name="numeroDeDocumento" id="numeroDeDocumento" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" name="usuario.username" id="usuario.username" required>
                    </div>
                </div>

                <!-- Función dentro del grupo -->
                <h5 class="mt-4">Función dentro del Grupo</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Rol</label>
                        <select class="form-select" name="usuario.rol" id="rol" onchange="actualizarCargos()" required>
                            <option value="" disabled selected>Seleccione...</option>
                            <th:block th:each="rol : ${roles}">
                                <option th:value="${rol}" th:text="${rol}"></option></th:block>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Cargo</label>
                        <select class="form-select"  name="cargo" id="cargo" disabled required>
                            <option value="" selected>Selecciona el Cargo...</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Rama</label>
                        <select class="form-select" name="rama" id="rama"  disabled>
                            <option value="" disabled selected>Seleccione...</option>
                            <th:block th:each="rama : ${ramas}">
                                <option th:value="${rama}" th:text="${rama}"></option></th:block>
                        </select>
                    </div>
                </div>

                <!-- Botones -->
                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">Agregar</button>
                    <button type="reset" class="btn btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>
</html>
